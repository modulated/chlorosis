use crate::Device;

use super::opcodes::Opcode;

impl Device {
    pub fn fetch_instruction(&mut self) -> Opcode {
        use Opcode::*;
        let op = self.consume_byte();

        match op.0 {
            // Row 0
            0x00 => NOP,
            0x01 => LD_BC_d16(self.consume_pair()),
            0x02 => LD_aBC_A,
            0x03 => INC_BC,
            0x04 => INC_B,
            0x05 => DEC_B,
            0x06 => LD_B_d8(self.consume_byte()),
            0x07 => RLCA,
            0x08 => LD_a16_SP(self.consume_pair()),
            0x09 => ADD_HL_BC,
            0x0A => LD_A_aBC,
            0x0B => DEC_BC,
            0x0C => INC_C,
            0x0D => DEC_C,
            0x0E => LD_C_d8(self.consume_byte()),
            0x0F => RRCA,
            // Row 0

            // Row 1
            0x10 => STOP(self.consume_byte()),
            0x11 => LD_DE_d16(self.consume_pair()),
            0x12 => LD_aDE_A,
            0x13 => INC_DE,
            0x14 => INC_D,
            0x15 => DEC_D,
            0x16 => LD_D_d8(self.consume_byte()),
            0x17 => RLA,
            0x18 => JR_s8(self.consume_signed_byte()),
            0x19 => ADD_HL_DE,
            0x1A => LD_A_aDE,
            0x1B => DEC_DE,
            0x1C => INC_E,
            0x1D => DEC_D,
            0x1E => LD_E_d8(self.consume_byte()),
            0x1F => RRA,
            // Row 1

            // Row 2
            0x20 => JR_NZ_s8(self.consume_signed_byte()),
            0x21 => LD_HL_d16(self.consume_pair()),
            0x22 => LD_aHL_inc_A,
            0x23 => INC_HL,
            0x24 => INC_H,
            0x25 => DEC_H,
            0x26 => LD_H_d8(self.consume_byte()),
            0x27 => DAA,
            0x28 => JR_Z_s8(self.consume_signed_byte()),
            0x29 => ADD_HL_HL,
            0x2A => LD_A_aHL_inc,
            0x2B => DEC_HL,
            0x2C => INC_L,
            0x2D => DEC_L,
            0x2E => LD_L_d8(self.consume_byte()),
            0x2F => CPL,
            // Row 2

            // Row 3
            0x30 => JR_NC_s8(self.consume_signed_byte()),
            0x31 => LD_SP_d16(self.consume_pair()),
            0x32 => LD_aHL_dec_A,
            0x33 => INC_SP,
            0x34 => INC_aHL,
            0x35 => DEC_aHL,
            0x36 => LD_aHL_d8(self.consume_byte()),
            0x37 => SCF,
            0x38 => JR_C_s8(self.consume_signed_byte()),
            0x39 => ADD_HL_SP,
            0x3A => LD_A_aHL_dec,
            0x3B => DEC_SP,
            0x3C => INC_A,
            0x3D => DEC_A,
            0x3E => LD_A_d8(self.consume_byte()),
            0x3F => CCF,
            // Row 3

            // Row 4
            0x40 => LD_B_B,
            0x41 => LD_B_C,
            0x42 => LD_B_D,
            0x43 => LD_B_E,
            0x44 => LD_B_H,
            0x45 => LD_B_L,
            0x46 => LD_B_aHL,
            0x47 => LD_B_A,
            0x48 => LD_C_B,
            0x49 => LD_C_C,
            0x4A => LD_C_D,
            0x4B => LD_C_E,
            0x4C => LD_C_H,
            0x4D => LD_C_L,
            0x4E => LD_C_aHL,
            0x4F => LD_C_A,
            // Row 4

            // Row 5
            0x50 => LD_D_B,
            0x51 => LD_D_C,
            0x52 => LD_D_D,
            0x53 => LD_D_E,
            0x54 => LD_D_H,
            0x55 => LD_D_L,
            0x56 => LD_D_aHL,
            0x57 => LD_D_A,
            0x58 => LD_E_B,
            0x59 => LD_E_C,
            0x5A => LD_E_D,
            0x5B => LD_E_E,
            0x5C => LD_E_H,
            0x5D => LD_E_L,
            0x5E => LD_E_aHL,
            0x5F => LD_E_A,
            // Row 5

            // Row 6
            0x60 => LD_H_B,
            0x61 => LD_H_C,
            0x62 => LD_H_D,
            0x63 => LD_H_E,
            0x64 => LD_H_H,
            0x65 => LD_H_L,
            0x66 => LD_H_aHL,
            0x67 => LD_H_A,
            0x68 => LD_L_B,
            0x69 => LD_L_C,
            0x6A => LD_L_D,
            0x6B => LD_L_E,
            0x6C => LD_L_H,
            0x6D => LD_L_L,
            0x6E => LD_L_aHL,
            0x6F => LD_L_A,
            // Row 6

            // Row 7
            0x70 => LD_aHL_B,
            0x71 => LD_aHL_C,
            0x72 => LD_aHL_D,
            0x73 => LD_aHL_E,
            0x74 => LD_aHL_H,
            0x75 => LD_aHL_L,
            0x76 => HALT,
            0x77 => LD_aHL_A,
            0x78 => LD_A_B,
            0x79 => LD_A_C,
            0x7A => LD_A_D,
            0x7B => LD_A_E,
            0x7C => LD_A_H,
            0x7D => LD_A_L,
            0x7E => LD_A_aHL,
            0x7F => LD_A_A,
            // Row 7

            // Row 8
            0x80 => ADD_B,
            0x81 => ADD_C,
            0x82 => ADD_D,
            0x83 => ADD_E,
            0x84 => ADD_H,
            0x85 => ADD_L,
            0x86 => ADD_aHL,
            0x87 => ADD_A,
            0x88 => ADC_B,
            0x89 => ADC_C,
            0x8A => ADC_D,
            0x8B => ADC_E,
            0x8C => ADC_H,
            0x8D => ADC_L,
            0x8E => ADC_aHL,
            0x8F => ADC_A,
            // Row 8

            // Row 9
            0x90 => SUB_B,
            0x91 => SUB_C,
            0x92 => SUB_D,
            0x93 => SUB_E,
            0x94 => SUB_H,
            0x95 => SUB_L,
            0x96 => SUB_aHL,
            0x97 => SUB_A,
            0x98 => SBC_B,
            0x99 => SBC_C,
            0x9A => SBC_D,
            0x9B => SBC_E,
            0x9C => SBC_H,
            0x9D => SBC_L,
            0x9E => SBC_aHL,
            0x9F => SBC_A,
            // Row 9

            // Row A
            0xA0 => AND_B,
            0xA1 => AND_C,
            0xA2 => AND_D,
            0xA3 => AND_E,
            0xA4 => AND_H,
            0xA5 => AND_L,
            0xA6 => AND_aHL,
            0xA7 => AND_A,
            0xA8 => XOR_B,
            0xA9 => XOR_C,
            0xAA => XOR_D,
            0xAB => XOR_E,
            0xAC => XOR_H,
            0xAD => XOR_L,
            0xAE => XOR_aHL,
            0xAF => XOR_A,
            // Row A

            // Row B
            0xB0 => OR_B,
            0xB1 => OR_C,
            0xB2 => OR_D,
            0xB3 => OR_E,
            0xB4 => OR_H,
            0xB5 => OR_L,
            0xB6 => OR_aHL,
            0xB7 => OR_A,
            0xB8 => CP_B,
            0xB9 => CP_C,
            0xBA => CP_D,
            0xBB => CP_E,
            0xBC => CP_H,
            0xBD => CP_L,
            0xBE => CP_aHL,
            0xBF => CP_A,
            // Row B

            // Row C
            0xC0 => RET_NZ,
            0xC1 => POP_BC,
            0xC2 => JP_NZ_a16(self.consume_pair()),
            0xC3 => JP_a16(self.consume_pair()),
            0xC4 => CALL_NZ_a16(self.consume_pair()),
            0xC5 => PUSH_BC,
            0xC6 => ADD_A_d8(self.consume_byte()),
            0xC7 => RST_0,
            0xC8 => RET_Z,
            0xC9 => RET,
            0xCA => JP_Z_a16(self.consume_pair()),
            0xCB => self.fetch_cb_instruction(),
            0xCC => CALL_Z_a16(self.consume_pair()),
            0xCD => CALL_a16(self.consume_pair()),
            0xCE => ADC_A_d8(self.consume_byte()),
            0xCF => RST_1,
            // Row C

            // Row D
            0xD0 => RET_NC,
            0xD1 => POP_DE,
            0xD2 => JP_NC_a16(self.consume_pair()),
            0xD3 => panic!("Illegal instruction {}", op),
            0xD4 => CALL_NC_a16(self.consume_pair()),
            0xD5 => PUSH_DE,
            0xD6 => SUB_d8(self.consume_byte()),
            0xD7 => RST_2,
            0xD8 => RET_C,
            0xD9 => RETI,
            0xDA => JP_C_a16(self.consume_pair()),
            0xDB => panic!("Illegal instruction {}", op),
            0xDC => CALL_C_a16(self.consume_pair()),
            0xDD => panic!("Illegal instruction {}", op),
            0xDE => SBC_A_d8(self.consume_byte()),
            0xDF => RST_3,
            // Row D

            // Row E
            0xE0 => LD_a8_A(self.consume_byte().to_address()),
            0xE1 => POP_HL,
            0xE2 => LD_aC_A,
            0xE3 => panic!("Illegal instruction {}", op),
            0xE4 => panic!("Illegal instruction {}", op),
            0xE5 => PUSH_HL,
            0xE6 => AND_d8(self.consume_byte()),
            0xE7 => RST_4,
            0xE8 => ADD_SP_s8(self.consume_signed_byte()),
            0xE9 => JP_HL,
            0xEA => LD_a16_A(self.consume_pair()),
            0xEB => panic!("Illegal instruction {}", op),
            0xEC => panic!("Illegal instruction {}", op),
            0xED => panic!("Illegal instruction {}", op),
            0xEE => XOR_d8(self.consume_byte()),
            0xEF => RST_5,
            // Row E

            // Row F
            0xF0 => LD_A_a8(self.consume_byte().to_address()),
            0xF1 => POP_AF,
            0xF2 => LD_A_aC,
            0xF3 => DI,
            0xF4 => panic!("Illegal instruction {}", op),
            0xF5 => PUSH_AF,
            0xF6 => OR_d8(self.consume_byte()),
            0xF7 => RST_6,
            0xF8 => LD_HL_SP_s8(self.consume_signed_byte()),
            0xF9 => LD_SP_HL,
            0xFA => LD_A_a16(self.consume_pair()),
            0xFB => EI,
            0xFC => panic!("Illegal instruction {}", op),
            0xFD => panic!("Illegal instruction {}", op),
            0xFE => CP_d8(self.consume_byte()),
            0xFF => RST_7,
            // Row F

            // _ => unreachable!("Unknown Opcode 0x{} at address {}", op, current_address),
        }
    }

    pub fn fetch_cb_instruction(&mut self) -> Opcode {
        use Opcode::*;
        let op = self.consume_byte();

        match op.0 {
            // Row 0
            0x00 => RLC_B,
            0x01 => RLC_C,
            0x02 => RLC_D,
            0x03 => RLC_E,
            0x04 => RLC_H,
            0x05 => RLC_L,
            0x06 => RLC_aHL,
            0x07 => RLC_A,
            0x08 => RRC_B,
            0x09 => RRC_C,
            0x0A => RRC_D,
            0x0B => RRC_E,
            0x0C => RRC_H,
            0x0D => RRC_L,
            0x0E => RRC_aHL,
            0x0F => RRC_A,
            // Row 0

            // Row 1
            0x10 => RL_B,
            0x11 => RL_C,
            0x12 => RL_D,
            0x13 => RL_E,
            0x14 => RL_H,
            0x15 => RL_L,
            0x16 => RL_aHL,
            0x17 => RL_A,
            0x18 => RR_B,
            0x19 => RR_C,
            0x1A => RR_D,
            0x1B => RR_E,
            0x1C => RR_H,
            0x1D => RR_L,
            0x1E => RR_aHL,
            0x1F => RR_A,
            // Row 1

            // Row 2
            0x20 => SLA_B,
            0x21 => SLA_C,
            0x22 => SLA_D,
            0x23 => SLA_E,
            0x24 => SLA_H,
            0x25 => SLA_L,
            0x26 => SLA_aHL,
            0x27 => SLA_A,
            0x28 => SRA_B,
            0x29 => SRA_C,
            0x2A => SRA_D,
            0x2B => SRA_E,
            0x2C => SRA_H,
            0x2D => SRA_L,
            0x2E => SRA_aHL,
            0x2F => SRA_A,
            // Row 2

            // Row 3
            0x30 => SWAP_B,
            0x31 => SWAP_C,
            0x32 => SWAP_D,
            0x33 => SWAP_E,
            0x34 => SWAP_H,
            0x35 => SWAP_L,
            0x36 => SWAP_aHL,
            0x37 => SWAP_A,
            0x38 => SRL_B,
            0x39 => SRL_C,
            0x3A => SRL_D,
            0x3B => SRL_E,
            0x3C => SRL_H,
            0x3D => SRL_L,
            0x3E => SRL_aHL,
            0x3F => SRL_A,
            // Row 3

            // Row 4
            0x40 => BIT_0_B,
            0x41 => BIT_0_C,
            0x42 => BIT_0_D,
            0x43 => BIT_0_E,
            0x44 => BIT_0_H,
            0x45 => BIT_0_L,
            0x46 => BIT_0_aHL,
            0x47 => BIT_0_A,
            0x48 => BIT_1_B,
            0x49 => BIT_1_C,
            0x4A => BIT_1_D,
            0x4B => BIT_1_E,
            0x4C => BIT_1_H,
            0x4D => BIT_1_L,
            0x4E => BIT_1_aHL,
            0x4F => BIT_1_A,
            // Row 4

            // Row 5
            0x50 => BIT_2_B,
            0x51 => BIT_2_C,
            0x52 => BIT_2_D,
            0x53 => BIT_2_E,
            0x54 => BIT_2_H,
            0x55 => BIT_2_L,
            0x56 => BIT_2_aHL,
            0x57 => BIT_2_A,
            0x58 => BIT_3_B,
            0x59 => BIT_3_C,
            0x5A => BIT_3_D,
            0x5B => BIT_3_E,
            0x5C => BIT_3_H,
            0x5D => BIT_3_L,
            0x5E => BIT_3_aHL,
            0x5F => BIT_3_A,
            // Row 5

            // Row 6
            0x60 => BIT_4_B,
            0x61 => BIT_4_C,
            0x62 => BIT_4_D,
            0x63 => BIT_4_E,
            0x64 => BIT_4_H,
            0x65 => BIT_4_L,
            0x66 => BIT_4_aHL,
            0x67 => BIT_4_A,
            0x68 => BIT_5_B,
            0x69 => BIT_5_C,
            0x6A => BIT_5_D,
            0x6B => BIT_5_E,
            0x6C => BIT_5_H,
            0x6D => BIT_5_L,
            0x6E => BIT_5_aHL,
            0x6F => BIT_5_A,
            // Row 6

            // Row 7
            0x70 => BIT_6_B,
            0x71 => BIT_6_C,
            0x72 => BIT_6_D,
            0x73 => BIT_6_E,
            0x74 => BIT_6_H,
            0x75 => BIT_6_L,
            0x76 => BIT_6_aHL,
            0x77 => BIT_6_A,
            0x78 => BIT_7_B,
            0x79 => BIT_7_C,
            0x7A => BIT_7_D,
            0x7B => BIT_7_E,
            0x7C => BIT_7_H,
            0x7D => BIT_7_L,
            0x7E => BIT_7_aHL,
            0x7F => BIT_7_A,
            // Row 7

            // Row 8
            0x80 => RES_0_B,
            0x81 => RES_0_C,
            0x82 => RES_0_D,
            0x83 => RES_0_E,
            0x84 => RES_0_H,
            0x85 => RES_0_L,
            0x86 => RES_0_aHL,
            0x87 => RES_0_A,
            0x88 => RES_1_B,
            0x89 => RES_1_C,
            0x8A => RES_1_D,
            0x8B => RES_1_E,
            0x8C => RES_1_H,
            0x8D => RES_1_L,
            0x8E => RES_1_aHL,
            0x8F => RES_1_A,
            // Row 8

            // Row 9
            0x90 => RES_2_B,
            0x91 => RES_2_C,
            0x92 => RES_2_D,
            0x93 => RES_2_E,
            0x94 => RES_2_H,
            0x95 => RES_2_L,
            0x96 => RES_2_aHL,
            0x97 => RES_2_A,
            0x98 => RES_3_B,
            0x99 => RES_3_C,
            0x9A => RES_3_D,
            0x9B => RES_3_E,
            0x9C => RES_3_H,
            0x9D => RES_3_L,
            0x9E => RES_3_aHL,
            0x9F => RES_3_A,
            // Row 9

            // Row A
            0xA0 => RES_4_B,
            0xA1 => RES_4_C,
            0xA2 => RES_4_D,
            0xA3 => RES_4_E,
            0xA4 => RES_4_H,
            0xA5 => RES_4_L,
            0xA6 => RES_4_aHL,
            0xA7 => RES_4_A,
            0xA8 => RES_5_B,
            0xA9 => RES_5_C,
            0xAA => RES_5_D,
            0xAB => RES_5_E,
            0xAC => RES_5_H,
            0xAD => RES_5_L,
            0xAE => RES_5_aHL,
            0xAF => RES_5_A,
            // Row A

            // Row B
            0xB0 => RES_6_B,
            0xB1 => RES_6_C,
            0xB2 => RES_6_D,
            0xB3 => RES_6_E,
            0xB4 => RES_6_H,
            0xB5 => RES_6_L,
            0xB6 => RES_6_aHL,
            0xB7 => RES_6_A,
            0xB8 => RES_7_B,
            0xB9 => RES_7_C,
            0xBA => RES_7_D,
            0xBB => RES_7_E,
            0xBC => RES_7_H,
            0xBD => RES_7_L,
            0xBE => RES_7_aHL,
            0xBF => RES_7_A,
            // Row B

            // Row C
            0xC0 => SET_0_B,
            0xC1 => SET_0_C,
            0xC2 => SET_0_D,
            0xC3 => SET_0_E,
            0xC4 => SET_0_H,
            0xC5 => SET_0_L,
            0xC6 => SET_0_aHL,
            0xC7 => SET_0_A,
            0xC8 => SET_1_B,
            0xC9 => SET_1_C,
            0xCA => SET_1_D,
            0xCB => SET_1_E,
            0xCC => SET_1_H,
            0xCD => SET_1_L,
            0xCE => SET_1_aHL,
            0xCF => SET_1_A,
            // Row C

            // Row D
            0xD0 => SET_2_B,
            0xD1 => SET_2_C,
            0xD2 => SET_2_D,
            0xD3 => SET_2_E,
            0xD4 => SET_2_H,
            0xD5 => SET_2_L,
            0xD6 => SET_2_aHL,
            0xD7 => SET_2_A,
            0xD8 => SET_3_B,
            0xD9 => SET_3_C,
            0xDA => SET_3_D,
            0xDB => SET_3_E,
            0xDC => SET_3_H,
            0xDD => SET_3_L,
            0xDE => SET_3_aHL,
            0xDF => SET_3_A,
            // Row D

            // Row E
            0xE0 => SET_4_B,
            0xE1 => SET_4_C,
            0xE2 => SET_4_D,
            0xE3 => SET_4_E,
            0xE4 => SET_4_H,
            0xE5 => SET_4_L,
            0xE6 => SET_4_aHL,
            0xE7 => SET_4_A,
            0xE8 => SET_5_B,
            0xE9 => SET_5_C,
            0xEA => SET_5_D,
            0xEB => SET_5_E,
            0xEC => SET_5_H,
            0xED => SET_5_L,
            0xEE => SET_5_aHL,
            0xEF => SET_5_A,
            // Row E

            // Row F
            0xF0 => SET_6_B,
            0xF1 => SET_6_C,
            0xF2 => SET_6_D,
            0xF3 => SET_6_E,
            0xF4 => SET_6_H,
            0xF5 => SET_6_L,
            0xF6 => SET_6_aHL,
            0xF7 => SET_6_A,
            0xF8 => SET_7_B,
            0xF9 => SET_7_C,
            0xFA => SET_7_D,
            0xFB => SET_7_E,
            0xFC => SET_7_H,
            0xFD => SET_7_L,
            0xFE => SET_7_aHL,
            0xFF => SET_7_A,
            // Row F
        }
    }
}
